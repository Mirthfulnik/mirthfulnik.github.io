<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>–í–æ–ª—à–µ–±–Ω—ã–π —à–∞—Ä ‚Äî Mini App</title>
<meta name="description" content="–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∏ –ø–æ—Ç—Ä—è—Å–∏ –≤–æ–ª—à–µ–±–Ω—ã–π —à–∞—Ä ‚Äî –æ–Ω –¥–∞—Å—Ç —Ç–µ–±–µ –æ—Ç–≤–µ—Ç!" />
<style>
  :root{ --bg:#0b0b0f; --bg2:#11131a; --text:#e9f1f6; --muted:#a9b4bf; }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    color:var(--text); background:linear-gradient(180deg,var(--bg),var(--bg2));
    padding:16px; display:flex; align-items:center; justify-content:center;
  }
  .app{width:100%; max-width:560px; text-align:center}
  h1{margin:4px 0 14px; font-weight:700; font-size:clamp(22px,3.2vw,28px)}
  p.sub{margin:0 0 18px; color:var(--muted); font-size:14px}
  .panel{background:#0f1420;border:1px solid #1f2a38;border-radius:18px;padding:18px}
  .ball{
    width:min(64vw,260px);height:min(64vw,260px);border-radius:50%;position:relative;
    background:radial-gradient(40% 40% at 35% 30%, #2b3e52, #0e1622 60%, #05070c 90%);
    box-shadow:0 0 0 2px #0f2430 inset,0 0 22px 2px #0af6ff22,0 0 80px #00f7ff14;
    display:grid;place-items:center;padding:22px;cursor:pointer;margin:0 auto;user-select:none;
  }
  .ball:before{content:"";position:absolute;inset:12px;border-radius:50%;
    background:radial-gradient(60% 40% at 30% 25%, #ffffff25, transparent 60%)}
  .answer{font-weight:700;font-size:clamp(14px,3.6vw,18px);color:#b9fbff;text-align:center;text-shadow:0 0 6px #0ff8}
  .controls{margin-top:14px;display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
  input{padding:12px 14px;border-radius:12px;border:1px solid #233243;background:#0f1521;color:var(--text);
    font-size:16px;max-width:340px;flex:1 1 240px}
  button{padding:12px 16px;border-radius:12px;border:1px solid transparent;font-weight:700;cursor:pointer;font-size:16px}
  .btn-main{background:linear-gradient(180deg,#0ef,#09c);color:#001218;border-color:#163b44}
  .btn-secondary{background:#0f1724;color:var(--text);border-color:#213040}
  .channel-info{margin-top:18px}
  .channel-info .title{font-weight:800;font-size:15px}
  .channel-info .desc{margin-top:4px;color:#a9b4bf}
  .channel-info .link{margin-top:8px}
  .channel-info .link button{display:inline-block}
  .hint{margin-top:10px; font-size:12px; color:#9cb2c7}
  .shake{animation:shake .7s cubic-bezier(.36,.07,.19,.97) both}
  @keyframes shake{
    10%{transform:translateX(-3px) rotate(-1deg)}20%{transform:translateX(4px) rotate(1deg)}
    30%{transform:translateX(-6px) rotate(-2deg)}40%{transform:translateX(6px) rotate(2deg)}
    50%{transform:translateX(-4px) rotate(-1.6deg)}60%{transform:translateX(4px) rotate(1.6deg)}
    70%{transform:translateX(-3px) rotate(-1deg)}80%{transform:translateX(3px) rotate(1deg)}
    90%{transform:translateX(-2px) rotate(-.6deg)}100%{transform:translateX(0) rotate(0)}
  }
</style>
</head>
<body>
<main class="app" role="main">
  <h1>üé± –í–æ–ª—à–µ–±–Ω—ã–π —à–∞—Ä</h1>
  <p class="sub">–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å, –ø–æ—Ç—Ä—è—Å–∏ —à–∞—Ä ‚Äî –∏ –ø–æ–ª—É—á–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ.</p>

  <section class="panel" aria-label="–ò–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞">
    <div class="ball" id="ball" tabindex="0" role="button" aria-label="–ü–æ—Ç—Ä—è—Å–∏ —à–∞—Ä (Enter/–ü—Ä–æ–±–µ–ª)">
      <div class="answer" id="answer">–°–ø—Ä–æ—Å–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å‚Ä¶</div>
    </div>

    <div class="controls">
      <input id="question" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–Ω–µ –ø–æ–≤–µ–∑—ë—Ç —Å–µ–≥–æ–¥–Ω—è?" inputmode="text" />
      <button id="askBtn" type="button" class="btn-main">–°–ø—Ä–æ—Å–∏—Ç—å</button>
      <button id="shareBtn" type="button" class="btn-secondary" disabled>–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
    </div>

    <div class="channel-info" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–Ω–∞–ª–µ">
      <div class="title">–¢–ì-–∫–∞–Ω–∞–ª ¬´–£–∂–µ –ª–µ—Ç–∏–º: –æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ –∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–∏¬ª</div>
      <div class="desc">–ö–µ–π—Å—ã, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∏–Ω—Å–∞–π—Ç—ã ‚Äî –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è</div>
      <div class="link">
        <button id="openChannel" type="button" class="btn-main">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
      </div>
      <div class="hint" id="shakeHint" hidden>–ü–æ–¥—Å–∫–∞–∑–∫–∞: –ø–æ—Ç—Ä—è—Å–∏ —Ç–µ–ª–µ—Ñ–æ–Ω, —á—Ç–æ–±—ã —Å–ø—Ä–æ—Å–∏—Ç—å —É —à–∞—Ä–∞.</div>
    </div>
  </section>
</main>

<!-- Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  // === Telegram MiniApp init ===
  const tg = window.Telegram?.WebApp;
  if (tg) { tg.ready(); tg.expand(); }

  // === App state ===
  const answers = [
    "–î–∞, –∫–æ–Ω–µ—á–Ω–æ!","–ù–µ—Ç, –Ω–µ —Å–µ–π—á–∞—Å.","–í–æ–∑–º–æ–∂–Ω–æ‚Ä¶","–õ—É—á—à–µ –Ω–µ –∑–Ω–∞—Ç—å.","–ë–µ–∑ —Å–æ–º–Ω–µ–Ω–∏–π ‚Äî –¥–∞!",
    "–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ.","–ú–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ.","–°–ø—Ä–æ—Å–∏ –ø–æ–∑–∂–µ.","–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ –¥–∞!","–ù–µ –¥—É–º–∞—é."
  ];

  const ball = document.getElementById("ball");
  const answerEl = document.getElementById("answer");
  const questionEl = document.getElementById("question");
  const askBtn = document.getElementById("askBtn");
  const shareBtn = document.getElementById("shareBtn");
  const openChannelBtn = document.getElementById("openChannel");
  const shakeHint = document.getElementById("shakeHint");
  let lastAnswer = "";
  let shakeEnabled = false;
  let lastShakeTime = 0;

  function haptic(type="medium"){ try{ tg?.HapticFeedback?.impactOccurred(type); }catch(_){} }
  function vibrate(ms=50){ if (navigator.vibrate) try{ navigator.vibrate(ms);}catch(_){} }
  const pickAnswer = () => answers[Math.floor(Math.random()*answers.length)];

  function shakeAndAnswer(){
    const q = questionEl.value.trim();
    if(!q){
      answerEl.textContent = "–°–Ω–∞—á–∞–ª–∞ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å!";
      questionEl.focus();
      return;
    }
    askBtn.disabled = true;
    ball.classList.remove("shake"); void ball.offsetWidth;
    ball.classList.add("shake");
    vibrate(40); haptic("light");

    setTimeout(()=>{
      lastAnswer = pickAnswer();
      answerEl.textContent = lastAnswer;
      askBtn.disabled = false;
      shareBtn.disabled = false;
      questionEl.focus();
      haptic("medium");
    }, 700);
  }

  // === Share (–≤–µ—Ä—Å–∏—è –∫–∞–∫ —Ä–∞–Ω—å—à–µ) + —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–æ—Ç–∞ ===
  async function shareResult(){
    const text =
`üé± –í–æ–ª—à–µ–±–Ω—ã–π —à–∞—Ä –æ—Ç–≤–µ—Ç–∏–ª:
–í–æ–ø—Ä–æ—Å: ${questionEl.value}
–û—Ç–≤–µ—Ç: ${lastAnswer}

@magic_ball_3000_bot`;

    try{
      if (tg && tg.platform) {
        // –û—Ç–∫—Ä–æ–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–∫–Ω–æ ¬´–ü–æ–¥–µ–ª–∏—Ç—å—Å—è¬ª –≤ Telegram
        tg.openTelegramLink('https://t.me/share/url?text=' + encodeURIComponent(text));
      } else if (navigator.share) {
        await navigator.share({ text });
      } else if (navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(text);
        alert("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.");
      } else {
        const ta = document.createElement("textarea");
        ta.value = text; document.body.appendChild(ta);
        ta.select(); document.execCommand("copy"); document.body.removeChild(ta);
        alert("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.");
      }
    }catch(_){ /* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –æ—Ç–º–µ–Ω–∏—Ç—å ‚Äî –æ–∫ */ }
  }

  // === Open channel button ===
  function openChannel(){
    const url = "https://t.me/uzhe_letim";
    if (tg) tg.openTelegramLink(url);
    else window.open(url, "_blank", "noopener,noreferrer");
  }

  // === Shake detection ===
  function enableShakeIfPossible(){
    if (shakeEnabled) return;

    const needsPerm = typeof DeviceMotionEvent !== "undefined" &&
                      typeof DeviceMotionEvent.requestPermission === "function";

    const attachListener = () => {
      window.addEventListener("devicemotion", onDeviceMotion, { passive: true });
      shakeEnabled = true;
      shakeHint.hidden = false;
      setTimeout(()=> shakeHint.hidden = true, 5000);
    };

    if (needsPerm) {
      DeviceMotionEvent.requestPermission()
        .then(state => { if (state === "granted") attachListener(); })
        .catch(()=>{});
    } else if ('ondevicemotion' in window){
      attachListener();
    }
  }

  function onDeviceMotion(e){
    const acc = e.accelerationIncludingGravity || e.acceleration || {x:0,y:0,z:0};
    const a = Math.sqrt((acc.x||0)**2 + (acc.y||0)**2 + (acc.z||0)**2);
    const THRESHOLD = 18;      // ‚âà1.8g
    const COOLDOWN = 1200;     // –º—Å

    const now = Date.now();
    if (a > THRESHOLD && (now - lastShakeTime) > COOLDOWN) {
      lastShakeTime = now;
      shakeAndAnswer();
    }
  }

  // === Events ===
  askBtn.addEventListener("click", () => { enableShakeIfPossible(); shakeAndAnswer(); });
  ball.addEventListener("click", () => { enableShakeIfPossible(); shakeAndAnswer(); });
  ball.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); enableShakeIfPossible(); shakeAndAnswer(); } });
  questionEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ enableShakeIfPossible(); shakeAndAnswer(); } });
  shareBtn.addEventListener("click", shareResult);
  openChannelBtn.addEventListener("click", openChannel);

  window.addEventListener("load", ()=> questionEl.focus(), { once:true });
</script>
</body>
</html>

